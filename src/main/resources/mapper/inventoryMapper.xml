<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssginc.ewms.inventory.mapper.InventoryMapper">

    <!--  현재 창고에 저장된 모든 재고현황을 검색하는 쿼리  -->
    <select id="getProductInventory"
            parameterType="int"
            resultType="inventoryStateVO">
        SELECT i.inventory_id, s.sector_name, i.product_id,
               p.product_name, c.category_name,
               su.supplier_name, p.income_price,
               p.outgoing_price, i.inventory_quantity,
               i.expiration_date
        FROM inventory i
                 JOIN sector s ON i.sector_id = s.sector_id
                 JOIN product p ON i.product_id = p.product_id
                 JOIN category c ON p.category_id = c.category_id
                 JOIN supplier su ON p.supplier_id = su.supplier_id
        WHERE s.warehouse_id = #{warehouseId} AND p.discontinued_status = 0
    </select>

    <!--  입력한 키워드에 따라 재고현황을 검색하는 쿼리  -->
    <select id="searchInventory"
            parameterType="string"
            resultType="inventoryStateVO">
        SELECT i.inventory_id, s.sector_name, i.product_id,
        p.product_name, c.category_name,
        su.supplier_name, p.income_price,
        p.outgoing_price, i.inventory_quantity,
        i.expiration_date
        FROM inventory i
        JOIN sector s ON i.sector_id = s.sector_id
        JOIN product p ON i.product_id = p.product_id
        JOIN category c ON p.category_id = c.category_id
        JOIN supplier su ON p.supplier_id = su.supplier_id
        WHERE s.warehouse_id = 1 AND p.discontinued_status = 0
        <if test="sectorName != null and sectorName != ''">
            AND s.sector_name LIKE CONCAT('%', #{sectorName}, '%')
        </if>
        <if test="startDate != null and startDate != ''">
            <![CDATA[AND i.expiration_date >= #{startDate}]]>
        </if>
        <if test="endDate != null and endDate != ''">
            <![CDATA[AND i.expiration_date <= #{endDate}]]>
        </if>
        <if test="productName != null and productName != ''">
            AND p.product_name LIKE CONCAT('%', #{productName}, '%')
        </if>
        <if test="supplierName != null and supplierName != ''">
            AND su.supplier_name LIKE CONCAT('%', #{supplierName}, '%')
        </if>
    </select>

    <!-- 현재 창고에서의 재고조정에 필요한 데이터를 검색하는 쿼리 -->
    <select id="getAdjustInventoryStatus"
            parameterType="int"
            resultType="inventoryAdjustVO">
        SELECT i.inventory_id, s.sector_name, i.product_id,
               p.product_name, p.income_price,
               p.outgoing_price, i.inventory_quantity,
               i.real_inventory_quantity, i.expiration_date
        FROM inventory i
                 JOIN sector s ON i.sector_id = s.sector_id
                 JOIN product p ON i.product_id = p.product_id
                 JOIN category c ON p.category_id = c.category_id
                 JOIN supplier su ON p.supplier_id = su.supplier_id
        WHERE p.discontinued_status = 0
        <if test="wareHouseId != 0">
            AND wareHouseId = #{warehouseId}
        </if>
    </select>
</mapper>